---
import Image from "astro/components/Image.astro";
import IntroImage from "../../assets/home/intro.png";
---

<section
  class="app-max-width flex flex-col gap-y-4 md:flex-row items-center gap-x-6 2xl:gap-x-8 py-[8dvw] overflow-hidden"
  id="home-intro-section"
>
  <div
    class="order-2 md:order-1 md:w-[50%] flex flex-col gap-y-4 h-full"
    id="home-intro-content"
  >
    <h3
      class="text-heading-black text-xl lg:text-2xl xl:text-3xl canvas:text-4xl 2xl:text-5xl font-semibold"
      id="home-intro-heading"
    >
      Turn your book ideas into reality with Nixxon Publishersâ€”your trusted
      writing partner.
    </h3>
    <div
      class="gap-y-1 flex flex-col text-[10px] sm:text-xs xl:text-sm canvas:text-base 2xl:text-lg 2xl flex-1 leading-tight"
      id="home-intro-paragraphs"
    >
      <p id="intro-p1">
        If you're looking to take your book journey to the next level, Nixxon
        Publishers Writing is the place for you. We offer complete book writing,
        publishing, and marketing services. Experienced experts in our
        leadership group are committed to making everything easy for you, and
        that includes our Entire Book Writing service.
      </p>
      <p id="intro-p2">
        Whether you're just starting to write or are well into the process, our
        professional services are available to help you polish your manuscript
        and make it shine. Our Publishing Services come into play after your
        work is complete, providing a variety of customizable packages that meet
        your specific requirements.
      </p>
      <p id="intro-p3">
        We take care of every detail to make sure your book is visually stunning
        as well as expertly produced, from the cover design to the printing.
      </p>
      <p id="intro-p4">
        The adventure doesn't end there, though, as our marketing services are
        meant to get your work the recognition it needs. We use social media
        campaigns, book launch parties, and focused communication as part of our
        strategic marketing approach to reach your target demographic.
      </p>
      <p id="intro-p5">
        Your book will be read by people all over the world thanks to our
        extensive distribution network, leaving a lasting impression on the
        literary world. Regardless of your level of experience, Nixxon
        Publishers Writing is dedicated to helping you every step of the way as
        you transform your idea into a published reality.
      </p>
      <p id="intro-p6">
        Are you prepared to start this amazing adventure? Select Nixxon
        Publishers Writing for a thorough experience that assures your next book
        will get the recognition and success it so richly merits
      </p>
    </div>
  </div>
  <div
    class="md:order-2 h-full md:w-[50%] overflow-hidden"
    id="home-intro-image-container"
  >
    <Image
      src={IntroImage}
      alt="Intro Image"
      class="w-full h-full object-cover"
      loading={"eager"}
      id="home-intro-image"
    />
  </div>
</section>

<script>
  import gsap from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";
  import SplitType from "split-type";

  // Register ScrollTrigger plugin
  gsap.registerPlugin(ScrollTrigger);

  document.addEventListener("DOMContentLoaded", () => {
    // Split heading text for character animation
    const heading = new SplitType("#home-intro-heading", {
      types: "chars, words",
    });

    // Get all paragraph elements
    const paragraphs = document.querySelectorAll("#home-intro-paragraphs p");

    // Set up different triggers based on screen size
    function createScrollTrigger() {
      // Clear any existing ScrollTriggers to prevent duplicates on resize
      ScrollTrigger.getAll().forEach((st) => st.kill());

      if (window.innerWidth < 768) {
        // MOBILE: Separate timelines for image and text

        // Image timeline
        const imageTimeline = gsap.timeline({ paused: true });

        // Image animation
        gsap.set("#home-intro-image", {
          clipPath: "inset(0 100% 0 0)",
          scale: 1.05,
        });

        imageTimeline.to("#home-intro-image", {
          clipPath: "inset(0 0% 0 0)",
          scale: 1,
          duration: 1.2,
          ease: "power3.out",
        });

        // Create image trigger
        ScrollTrigger.create({
          trigger: "#home-intro-image-container",
          start: "top 80%",
          onEnter: () => imageTimeline.play(),
        });

        // Text timeline
        const textTimeline = gsap.timeline({ paused: true });

        // Heading animation
        textTimeline.from(heading.chars, {
          opacity: 0,
          y: 20,
          rotateX: -90,
          stagger: 0.02,
          duration: 0.7,
          ease: "back.out(1.5)",
        });

        // Paragraphs animation
        textTimeline.from(
          paragraphs,
          {
            opacity: 0,
            y: 30,
            stagger: 0.15,
            duration: 0.8,
            ease: "power2.out",
          },
          "-=0.4",
        );

        // Create text trigger
        ScrollTrigger.create({
          trigger: "#home-intro-content",
          start: "top 80%",
          onEnter: () => textTimeline.play(),
        });
      } else {
        // DESKTOP: Single timeline for everything
        const desktopTimeline = gsap.timeline({ paused: true });

        // Heading animation
        desktopTimeline.from(heading.chars, {
          opacity: 0,
          y: 20,
          rotateX: -90,
          stagger: 0.02,
          duration: 0.7,
          ease: "back.out(1.5)",
        });

        // Paragraphs animation
        desktopTimeline.from(
          paragraphs,
          {
            opacity: 0,
            y: 30,
            stagger: 0.15,
            duration: 0.8,
            ease: "power2.out",
          },
          "-=0.4",
        );

        // Image animation
        gsap.set("#home-intro-image", {
          clipPath: "inset(0 100% 0 0)",
          scale: 1.05,
        });

        desktopTimeline.to(
          "#home-intro-image",
          {
            clipPath: "inset(0 0% 0 0)",
            scale: 1,
            duration: 1.2,
            ease: "power3.out",
          },
          "-=1.5",
        );

        // Desktop trigger
        ScrollTrigger.create({
          trigger: "#home-intro-content",
          start: "top 70%",
          onEnter: () => desktopTimeline.play(),
        });
      }
    }

    // Initial setup
    createScrollTrigger();

    // Update on window resize
    window.addEventListener("resize", () => {
      // Debounce resize events
      clearTimeout(window.resizeTimer);
      window.resizeTimer = setTimeout(createScrollTrigger, 250);
    });
  });
</script>

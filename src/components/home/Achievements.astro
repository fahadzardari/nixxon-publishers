---
import Image from "astro/components/Image.astro";
import Books from "../../assets/home/achievements.png";
---

<section class="app-right-padding flex gap-x-1 py-16" id="achievements-section">
  <div class="w-1/2 image-container">
    <Image src={Books} alt="Books" class="w-full" />
  </div>
  <div class="flex-1 content-container">
    <h3
      class="xl:text-4xl lg:text-3xl md:text-2xl text-xl font-semibold text-primary-red mb-2 achievement-title"
    >
      Our Achievements
    </h3>
    <p class="text-xs md:text-sm xl:text-base achievement-text">
      Our list of clients includes the bestselling writers, editorial agencies,
      businesses, publication companies, journals, and various first-time
      authors. We stand as the well-reputed firm in the ghostwriting industry
      and our clients have achieved their publication goals effectively. Whether
      you require a traditional book, or comprehensive ghostwriting services, we
      ensure your book is readily available to the target audience.
    </p>
    <div class="flex justify-between gap-x-3 stats-container">
      <div class="flex flex-col items-center w-1/3 stat-item">
        <h4
          class="xl:text-[66px] text-primary-red font-bold font-comme-regular -mb-2 counter"
          data-target="9"
        >
          0
        </h4>
        <p
          class="font-semibold text-xs md:text-sm xl:text-base text-center stat-title"
        >
          Years of Experience
        </p>
        <p class="text-xs text-center stat-description">
          We have over 9 years of experience in Designing, Writing and Marketing
        </p>
      </div>
      <div class="flex flex-col items-center w-1/3 stat-item">
        <h4
          class="xl:text-[66px] text-primary-red font-bold font-comme-regular -mb-2 counter"
          data-target="100"
          data-suffix="+"
        >
          0
        </h4>
        <p
          class="font-semibold text-xs md:text-sm xl:text-base text-center stat-title"
        >
          Books Published
        </p>
        <p class="text-xs text-center stat-description">
          The counter is going up day by day. We know how to publish books in a
          fast manner.
        </p>
      </div>
      <div class="flex flex-col items-center w-1/3 stat-item">
        <h4
          class="xl:text-[66px] text-primary-red font-bold font-comme-regular -mb-2 counter"
          data-target="250"
          data-suffix="+"
        >
          0
        </h4>
        <p
          class="font-semibold text-xs md:text-sm xl:text-base text-center stat-title"
        >
          Clients
        </p>
        <p class="text-xs text-center stat-description">
          Ghostwriting Professionals has clients from all around the globe.
        </p>
      </div>
    </div>
  </div>
</section>

<script>
  import gsap from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";
  import SplitType from "split-type";

  // Register ScrollTrigger plugin
  gsap.registerPlugin(ScrollTrigger);

  // Split text for animations
  const achievementTitle = new SplitType(".achievement-title", {
    types: "words, chars",
  });
  const achievementText = new SplitType(".achievement-text", {
    types: "lines",
  });
  const statTitles = new SplitType(".stat-title", { types: "words" });

  // Set initial states
  gsap.set("#achievements-section", { opacity: 0, y: 50 });
  gsap.set(".image-container", { opacity: 0, x: -50 });
  gsap.set(achievementTitle.chars, { opacity: 0, y: 20 });
  gsap.set(achievementText.lines, { opacity: 0, y: 10 });
  gsap.set(".stat-item", { opacity: 0, y: 30 });

  // Create the animation timeline
  const tl = gsap.timeline({
    scrollTrigger: {
      trigger: "#achievements-section",
      start: "top 80%",
      toggleActions: "play none none none",
    },
  });

  // Add animations to timeline
  tl.to("#achievements-section", { opacity: 1, y: 0, duration: 0.6 })
    .to(".image-container", { opacity: 1, x: 0, duration: 0.8 }, "-=0.4")
    .to(
      achievementTitle.chars,
      {
        opacity: 1,
        y: 0,
        duration: 0.6,
        stagger: 0.02,
      },
      "-=0.4"
    )
    .to(
      achievementText.lines,
      {
        opacity: 1,
        y: 0,
        duration: 0.6,
        stagger: 0.1,
      },
      "-=0.2"
    )
    .to(
      ".stat-item",
      {
        opacity: 1,
        y: 0,
        stagger: 0.2,
        duration: 0.8,
      },
      "-=0.4"
    );

  // Sequential counter animations
  const counters = document.querySelectorAll(".counter");

  // Wait for the stats container to be visible before starting counters
  tl.add(() => {
    // First counter (9 years)
    const counter1 = counters[0];
    const target1 = parseInt(counter1.getAttribute("data-target"));

    gsap.to(counter1, {
      innerHTML: target1,
      duration: 0.5,
      ease: "power1.inOut",
      onUpdate: function () {
        counter1.innerHTML = Math.ceil(this.targets()[0].innerHTML);
      },
      onComplete: startSecondCounter,
    });
  });

  function startSecondCounter() {
    // Second counter (100+ books)
    const counter2 = counters[1];
    const target2 = parseInt(counter2.getAttribute("data-target"));
    const suffix2 = counter2.getAttribute("data-suffix") || "";

    gsap.to(counter2, {
      innerHTML: target2,
      duration: 2,
      ease: "power1.inOut",
      onUpdate: function () {
        counter2.innerHTML = Math.ceil(this.targets()[0].innerHTML) + suffix2;
      },
      onComplete: startThirdCounter,
    });
  }

  function startThirdCounter() {
    // Third counter (250+ clients)
    const counter3 = counters[2];
    const target3 = parseInt(counter3.getAttribute("data-target"));
    const suffix3 = counter3.getAttribute("data-suffix") || "";

    gsap.to(counter3, {
      innerHTML: target3,
      duration: 2.5,
      ease: "power1.inOut",
      onUpdate: function () {
        counter3.innerHTML = Math.ceil(this.targets()[0].innerHTML) + suffix3;
      },
    });
  }
</script>
